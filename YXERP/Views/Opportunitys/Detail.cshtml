@{
    ViewBag.Title = "销售机会详情";
    var model = (CloudSalesEntity.OpportunityEntity)ViewBag.Model;
}
@section css{
    <link href="/modules/css/sales.css" rel="stylesheet" />
}
@section scripts{
    <script type="text/javascript">
        seajs.use(["scripts/sales/opportunity-detail"], function (obj) {
            obj.init('@(model.OpportunityID)','@Html.ToJSONString(model)','@Html.ToJSONString((List<CloudSalesEntity.OrderTypeEntity>)ViewBag.OrderTypes)');
        });
    </script>
}
<div class="header-box">
    <span class="header-title left">机会编号：@(model.OpportunityCode)</span>
    @if (model.Status==1)
    {
        <div id="editOpportunity" class="iconfont icon-edit left">&#xe607;</div>
        
        <div class="btnccc right @(ExpandClass.IsLimits(HttpContext.Current,"102029003"))" id="btndelete" >关闭机会</div>
        <div class="btn right mRight20" id="btnconfirm" >转为订单</div>
    }
    
</div>
<div class="content-body">
    <ul class="content-info">
        <li>
            <span class="column-title">客户名称：</span> 
            <a href="/Customer/Detail/@(model.CustomerID)" target="_blank">@(model.Customer.Name)</a> </li>
        <li>
            <span class="column-title">拥有者：</span> 
            <label class="left" id="lblOwner">@(model.Owner.Name)</label>
            <span title="更换拥有者" class="iconfont icon-change left mLeft10 @(ExpandClass.IsLimits(HttpContext.Current,"102029002"))" data-userid="@(model.OwnerID)" data-id="@(model.OpportunityID)" id="changeOwner">&#xe60b;</span>
        </li>
         <li>
            <span class="column-title">联系人：</span>
            <label>@(model.PersonName)</label>
        </li>
        <li>
            <span class="column-title">联系方式：</span>
            <label>@(model.MobileTele)</label>
        </li>
            
        <li>
            <span class="column-title">地址：</span>
            <label>@(model.City!=null?(model.City.Province+" "+model.City.City+" "+model.City.Counties):"")@(model.Address)</label>
        </li>
        <li>
            <span class="column-title">订单类型：</span>
            <label>@(model.OrderType!=null?model.OrderType.TypeName:"--")</label>
        </li>
        <li style="width:100%;">
            <span class="column-title">备注：</span> 
            <label>@(model.Remark.Trim())</label>
        </li>
    </ul>
    <div class="clear"></div>
    <ul class="stage-items mTop30">
        @foreach (var stage in (List<CloudSalesEntity.OpportunityStageEntity>)ViewBag.Stages)
        { 
            <li data-id="@(stage.StageID)" data-mark="@(stage.Mark)">
                <span class="leftbg bg"></span>
                <span class="name">@(stage.StageName)(@((stage.Probability*100).ToString("f2"))%)</span>
                <span class="rightbg bg"></span>
            </li>
        }
    </ul>
    <div class="tab-nav mTop30">
        <ul class="tab-nav-ul left">
            <li class="hover" data-id="navProducts">意向产品</li>
            <li data-id="navRemark">备忘</li>
            <li data-id="navLog">日志</li>
        </ul>
    </div>
    <div id="navProducts" class="nav-partdiv">
        <table class="table-list mTop20">
            <tr class="tr-header">
                <td class="tLeft">产品名称</td>
                <td class="tLeft">规格</td>
                <td class="center width80">单位</td>
                <td class="">单价</td>
                <td class="center">数量</td>
                <td class="tRight">小计</td>
                <td class="center width80">删除</td>
            </tr>
            @foreach (var detail in model.Details)
            { 
                <tr class="item cart-item" data-autoid="@(detail.AutoID)" data-id="@(detail.ProductDetailID)" >
                    <td><a href="/Products/ChooseDetail?pid=@(detail.ProductID)&did=@(detail.ProductDetailID)&type=11&guid=@(model.OpportunityID)" target="_blank">@(detail.ProductName)</a></td>
                    <td>@(detail.Remark)</td>
                    <td class="center">@(detail.UnitName)</td>
                    <td class="tr-price center"><input type="text" data-id="@(detail.AutoID)" data-value="@(detail.Price.ToString("f2"))" class="price width80" value="@(detail.Price.ToString("f2"))" /></td>
                    @*<td class="tr-price tRight"><label class="price">@(detail.Price.ToString("f2"))</label></td>*@
                    <td class="center tr-quantity"><input  type="text" data-id="@(detail.AutoID)" data-value="@(detail.Quantity)" class="quantity width50" value="@(detail.Quantity)" /></td>
                    <td class="tRight amount">@((detail.Price*detail.Quantity).ToString("f2"))</td>
                    <td class="center">
                        <a class="ico-del" href="javascript:void(0)" title="删除" data-id="@(detail.AutoID)"></a>
                    </td>
                </tr>
            }
            <tr class="amount-item">
                <td></td>
                <td></td>
                <td></td>
                <td></td>
                <td class="tRight">合计：</td>
                <td class="tRight"><label id="amount"></label></td>
                <td></td>
            </tr>
        </table>
        <div class="mTop20">
             <a href="/Opportunitys/ChooseProducts/@(model.OpportunityID)" class="btn right mRight20">继续选择产品</a>
        </div>
    </div>
    <div id="navRemark" class="mTop20 talk-body nav-partdiv hide">
        <div class="content-main">
            <textarea id="txtContent" class="txt-content left"></textarea>
            <span class="btn btn-save" id="btnSaveTalk">提交</span>
        </div>
        <div class="talk-title"> 全部备忘 </div>
         <table class="content-list" id="replyList">

         </table>
        <div id="pagerReply" class="mTop10"></div>
    </div>
     @*日志*@
    <div class="nav-partdiv hide" id="navLog">
        <div class="log-body" id="opportunityLog">

        </div>
        <div id="pagerLogs" class="mTop10">

        </div>
    </div>
</div>
